(()=>{"use strict";const e=require("dotenv"),n=require("nodemailer"),o=require("express"),r=require("path"),i=require("url"),s=require("body-parser");e.config();const{EMAIL:t,EMAIL_APP_PASSWORD:a,EMAILS_TO_FORWARD:c,PORT:l}=process.env;t&&a&&c||(console.error("Missing required environment variables"),process.exit(1));const d=o(),u=r.dirname((0,i.fileURLToPath)("file:///Users/jhoncasallasbernal/Documents%20Local/JhonRepos/resval/index.js"));d.use(o.static(r.join(u,"/public"))),d.use(s.urlencoded({extended:!0})),d.get("*",((e,n)=>{n.sendFile(r.join(u,"index.html"))})),d.post("/sendemail",(async(e,o)=>{try{await async function(e){const o=n.createTransport({service:"gmail",auth:{user:t,pass:a}}),r=function(e){if(!e)throw new Error("User data is required.");return`\n    Una persona solicitó información por la página web, ponerse en contacto inmediatamente:\n    Nombre: ${e.name||"Unknown name"}\n    Ciudad: ${e.ciudad||"Unknown city"}\n    Email: ${e.email||"No email provided"}\n    Teléfono: ${e.telefono||"No phone number provided"}\n    Mensaje: ${e.message||"No message provided"}\n  `}(e.user),i={from:t,to:c,subject:"Solicitud de informacion",text:r};return o.sendMail(i)}(e.body),o.sendFile(r.join(u,"gracias.html"))}catch(e){console.error("Failed to send email:",e),o.status(500).send("Email could not be sent")}}));const m=l||3e3;d.listen(m,(()=>{console.log(`Server listening on port ${m} in ${d.settings.env} mode`)}))})();